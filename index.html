<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Reaper Net - v1.7.76</title>
		<link
			rel="stylesheet"
			href="leaflet/leaflet.css" />
		<link
			rel="stylesheet"
			href="assets/bootstrap/css/bootstrap.css" />
		<link
			rel="stylesheet"
			href="assets/bootstrap/icons/bootstrap-icons.min.css" />

		<script src="leaflet/leaflet.js"></script>
		<script src="leaflet/plugins/Leaflet.Graticule.min.js"></script>
		<script src="assets/js/jquery-3.7.1.min.js"></script>
		<script src="assets/js/turf.min.js"></script>
		<script src="assets/js/leaflet-omnivore.min.js"></script>
		<script src="assets/js/georaster.browser.bundle.min.js"></script>
		<script src="assets/js/georaster-layer-for-leaflet.min.js"></script>
		<script src="assets/js/jszip.min.js"></script>
		<script src="assets/bootstrap/js/bootstrap.js"></script>
		<script src="assets/js/socket.io.min.js"></script>
		<script src="assets/js/parts/reaper-node.js"></script>
		<link
			rel="stylesheet"
			href="assets/css/main.css" />
	</head>

	<body>
		<div id="app">
			<div
				id="toolbar"
				class="d-flex flex-column align-items-center">
				<button
					class="btn btn-dark mb-2"
					title="Zoom In">
					<i class="bi bi-zoom-in"></i>
				</button>
				<button
					class="btn btn-dark mb-2"
					title="Zoom Out">
					<i class="bi bi-zoom-out"></i>
				</button>
				<button
					class="btn btn-dark mb-2"
					title="Signal Radar"
					onclick="var modal = new bootstrap.Modal(document.getElementById('signalRadarModal'), { backdrop: false }); modal.show();">
					<i class="bi bi-radar"></i>
				</button>
				<button
					class="btn btn-dark mb-2"
					title="Reaper Node Console"
					onclick="var modal = new bootstrap.Modal(document.getElementById('reaperConsoleModal'), { backdrop: false }); modal.show();">
					<i class="bi bi-terminal"></i>
				</button>
			</div>

			<div
				id="sidebar"
				style="position: absolute; top: 0; right: 0; width: 300px; height: 100%; background: rgba(0, 0, 0, 0.8); color: white; display: flex; flex-direction: column; z-index: 1000">
				<div
					id="sidebar-tabs"
					style="display: flex; justify-content: space-around; padding: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.2)">
					<button
						class="btn btn-dark"
						style="flex: 1"
						onclick="showTabContent('tab1')"
						title="Reaper Net Info">
						<i class="bi bi-house"></i>
					</button>
					<button
						class="btn btn-dark"
						style="flex: 1"
						onclick="showTabContent('tab2')"
						title="Reaper Contacts">
						<i class="bi bi-wifi"></i>
					</button>
					<button
						class="btn btn-dark"
						style="flex: 1"
						onclick="showTabContent('tab3')">
						<i class="bi bi-gear"></i>
					</button>
					<button
						class="btn btn-dark"
						style="flex: 1"
						onclick="showTabContent('tab3')">
						<i class="bi bi-gear"></i>
					</button>
					<button
						class="btn btn-dark"
						style="flex: 1"
						onclick="showTabContent('tab3')">
						<i class="bi bi-gear"></i>
					</button>
					<button
						class="btn btn-dark"
						style="flex: 1"
						onclick="showTabContent('tab3')">
						<i class="bi bi-gear"></i>
					</button>
				</div>
				<div
					id="sidebar-content"
					style="flex: 1; padding: 10px; overflow-y: auto">
					<div
						id="tab1"
						class="tab-content"
						style="display: none">
						<h4 class="light-text">Reaper Net v1.7.76a</h4>
						<p>Developed by Justin Greer</p>

						<img
							src="assets/images/generated-sample.png"
							alt="Reaper Logo"
							style="width: 100%; margin-bottom: 10px; opacity: 0.5" />

						<div class="connection-statuses">
							<h4 class="light-text">Connections</h4>
							<div class="status">
								<span class="connection-name">Internet:</span>
								<span id="internet-connection-status"></span>
							</div>
							<div class="status">
								<span class="connection-name">Reaper Node:</span>
								<span id="reaper-node-status"></span>
							</div>
							<div class="status">
								<span class="connection-name">GPS Device:</span>
								<span id="gps-status"></span>
							</div>
						</div>
					</div>
					<div
						id="tab2"
						class="tab-content"
						style="display: none">
						<h4
							class="light-text"
							id="node-list-header">
							Nodes (0)
						</h4>
						<div class="node-list mb-3">
							<ul
								id="node-list"
								style="list-style: none; padding: 0; margin: 0">
								No Nodes
							</ul>
						</div>
					</div>
					<div
						id="tab3"
						class="tab-content"
						style="display: none">
						<h4>Settings</h4>
						<p>This is the settings tab content.</p>
					</div>
				</div>
			</div>

			<div
				id="sendMessageWindow"
				style="
					position: absolute;
					top: 50px;
					left: 50px;
					width: 400px;
					height: 300px;
					background: rgba(0, 0, 0, 0.9);
					color: white;
					border: 1px solid rgba(255, 255, 255, 0.2);
					z-index: 2000;
					resize: both;
					overflow: hidden;
					display: none;
				">
				<div style="display: flex; justify-content: space-between; align-items: center; background: rgba(255, 255, 255, 0.1); padding: 5px; cursor: move">
					<span>Send Message</span>
					<button
						style="background: none; border: none; color: white; font-size: 16px; cursor: pointer"
						onclick="document.getElementById('sendMessageWindow').style.display = 'none'">
						&times;
					</button>
				</div>
				<div style="padding: 10px; flex: 1; display: flex; flex-direction: column">
					<textarea
						style="flex: 1; width: 100%; background: rgba(0, 0, 0, 0.8); color: white; border: 1px solid rgba(255, 255, 255, 0.2); margin-bottom: 10px; padding: 5px"
						placeholder="Type your message here..."></textarea>
					<button style="background: rgba(0, 0, 0, 0.8); color: white; border: 1px solid rgba(255, 255, 255, 0.2); padding: 5px; cursor: pointer">Send</button>
				</div>
				<div style="background: rgba(255, 255, 255, 0.1); padding: 5px; display: flex; justify-content: space-around; border-top: 1px solid rgba(255, 255, 255, 0.2)">
					<a
						href="#"
						style="color: white; text-decoration: none; font-size: 12px"
						onclick="quickMessage('Wilco')">
						Wilco
					</a>
					<a
						href="#"
						style="color: white; text-decoration: none; font-size: 12px"
						onclick="quickMessage('Standby')">
						Standby
					</a>
					<a
						href="#"
						style="color: white; text-decoration: none; font-size: 12px"
						onclick="quickMessage('Roger That')">
						Roger That
					</a>
					<a
						href="#"
						style="color: white; text-decoration: none; font-size: 12px"
						onclick="quickMessage('41.47026,-80.87242')">
						Send Location
					</a>
				</div>
			</div>

			<!-- Reaper Node Console Modal -->
			<div
				class="modal"
				id="reaperConsoleModal"
				tabindex="-1"
				aria-labelledby="reaperConsoleModalLabel"
				aria-hidden="true">
				<div class="modal-dialog modal-lg modal-dialog-centered">
					<div class="modal-content">
						<div class="modal-header">
							<h5
								class="modal-title light-text"
								id="reaperConsoleModalLabel">
								Reaper Node Console
							</h5>
							<button
								type="button"
								class="btn-close btn-close-white"
								data-bs-dismiss="modal"
								aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<pre
								id="reaper-log"
								style="height: 300px; overflow: auto; background: #000; padding: 10px; font-size: 10px; margin-bottom: 10px"></pre>
							<input
								id="reaper-cmd-input"
								class="form-control"
								type="text"
								placeholder="AT+DEVICE"
								style="width: 100%; margin-bottom: 10px" />
							<button
								id="send-reaper-cmd-btn"
								class="btn btn-primary">
								Send Command
							</button>
							<div style="display: flex; gap: 10px; margin-top: 10px">
								<button
									class="btn btn-secondary btn-sm"
									onclick="document.getElementById('reaper-cmd-input').value='AT+MSG=Radio Check'">
									AT+MSG=Radio Check
								</button>
								<button
									class="btn btn-secondary btn-sm"
									onclick="document.getElementById('reaper-cmd-input').value='AT+DEVICE'">
									AT+DEVICE
								</button>
								<button
									class="btn btn-secondary btn-sm"
									onclick="document.getElementById('reaper-cmd-input').value='AT+'">
									AT+
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- Reaper Node Console -->

			<!-- Signal Radar Modal -->
			<div
				class="modal"
				id="signalRadarModal"
				tabindex="-1"
				aria-labelledby="signalRadarModalLabel"
				aria-hidden="true">
				<div class="modal-dialog modal-lg modal-dialog-centered">
					<div
						class="modal-content"
						style="background: #222; color: #fff">
						<div
							class="modal-header"
							style="border-bottom: 1px solid #444">
							<h5
								class="modal-title light-text"
								id="signalRadarModalLabel">
								Signal Radar
							</h5>
							<button
								type="button"
								class="btn-close btn-close-white"
								data-bs-dismiss="modal"
								aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<div
								id="signal-bar-graph"
								style="width: 100%; max-width: 900px; margin: 0 auto; padding: 20px 0">
								<!-- Bars will be injected here -->
							</div>
						</div>
					</div>
				</div>
			</div>
			<script>
				// Example signals
				let signals = [
					{ name: "AirTag EJ354", strength: 0 },
					{ name: "Tile JGTH", strength: 0 },
					{ name: "iPhone", strength: 0 },
					{ name: "Android Device", strength: 0 },
				];

				function randomStrength() {
					return Math.floor(Math.random() * 101); // 0-100
				}

				function updateSignalStrengths() {
					signals.forEach((sig) => {
						sig.strength = randomStrength();
					});
				}

				function renderSignalBarGraph() {
					const container = document.getElementById("signal-bar-graph");
					container.innerHTML = "";
					signals.forEach((sig) => {
						const barContainer = document.createElement("div");
						barContainer.style.display = "flex";
						barContainer.style.alignItems = "center";
						barContainer.style.marginBottom = "18px";

						const label = document.createElement("span");
						label.textContent = sig.name;
						label.style.width = "120px";
						//label.style.fontWeight = "bold";

						const barBg = document.createElement("div");
						barBg.style.background = "#444";
						barBg.style.width = "60%";
						barBg.style.height = "24px";
						barBg.style.margin = "0 16px";
						//barBg.style.borderRadius = "8px";
						barBg.style.overflow = "hidden";
						barBg.style.position = "relative";

						const bar = document.createElement("div");
						bar.style.height = "100%";
						// Convert strength (0-100) to RSSI dBm (e.g., -100 to -30)
						const minDbm = -100,
							maxDbm = -30;
						const dbm = Math.round(minDbm + (sig.strength / 100) * (maxDbm - minDbm));
						// Map dBm to width (0-100%)
						const widthPercent = ((dbm - minDbm) / (maxDbm - minDbm)) * 100;
						bar.style.width = widthPercent + "%";
						bar.style.background = "linear-gradient(90deg, #2d3a13 0%, #3a4d1a 100%)";
						bar.style.transition = "width 0.5s";

						const value = document.createElement("span");
						value.textContent = dbm + " dBm";
						value.style.width = "50px";
						value.style.textAlign = "right";

						barBg.appendChild(bar);
						barContainer.appendChild(label);
						barContainer.appendChild(barBg);
						barContainer.appendChild(value);

						container.appendChild(barContainer);
					});
				}

				function refreshSignalRadar() {
					updateSignalStrengths();
					renderSignalBarGraph();
				}

				document.addEventListener("DOMContentLoaded", function () {
					// Show modal when radar button is clicked
					const radarBtn = Array.from(document.querySelectorAll('button[title="Signal Radar"]'))[0];
					if (radarBtn) {
						radarBtn.addEventListener("click", function () {
							var modal = new bootstrap.Modal(document.getElementById("signalRadarModal"));
							modal.show();
							refreshSignalRadar();
						});
					}

					// Update graph every 5 seconds while modal is open
					let intervalId = null;
					const radarModal = document.getElementById("signalRadarModal");
					radarModal.addEventListener("show.bs.modal", function () {
						refreshSignalRadar();
						intervalId = setInterval(refreshSignalRadar, 1000);
					});
					radarModal.addEventListener("hide.bs.modal", function () {
						clearInterval(intervalId);
					});
				});
			</script>

			<div id="map"></div>
		</div>
		<script src="assets/js/main.js"></script>
		<script src="assets/js/parts/draggable-ui.js"></script>
		<script src="assets/js/parts/tabs.js"></script>
		<script src="assets/js/parts/messages.js"></script>
	</body>
</html>
